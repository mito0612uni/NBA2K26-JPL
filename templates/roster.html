{% extends "layout.html" %}
{% block content %}
  <hr style="margin: 30px 0;">

  <h2>登録済みリスト</h2>
  {% if teams %}
    {% for team in teams %}
      <div style="margin-bottom: 20px;">
        {% if team.players %}
          <ul style="list-style-type: none; padding-left: 15px;">
            {% for player in team.players %}
              <li style="padding: 5px 0; border-top: 1px solid #f0f0f0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span>{{ player.name }}</span>
                  <div>
                    {# ★★★ ここからが追加・修正部分 ★★★ #}
                    <button class="edit-btn" onclick="toggleForm('edit-{{ player.id }}')">名前変更</button>
                    <button class="transfer-btn" onclick="toggleForm('transfer-{{ player.id }}')">移籍</button>
                    <form action="{{ url_for('delete_player', player_id=player.id) }}" method="post" onsubmit="return confirm('本当にこの選手を削除しますか？');" style="display: inline;">
                      <button type="submit">削除</button>
                    </form>
                    {# ★★★ ここまで ★★★ #}
                  </div>
                </div>
                {# --- 名前変更フォーム (最初は非表示) --- #}
                <div id="edit-{{ player.id }}" style="display: none; margin-top: 10px;">
                  <form method="post">
                    <input type="hidden" name="action" value="edit_player">
                    <input type="hidden" name="player_id" value="{{ player.id }}">
                    <input type="text" name="new_name" value="{{ player.name }}" required>
                    <button type="submit">変更を保存</button>
                  </form>
                </div>
                {# --- 移籍フォーム (最初は非表示) --- #}
                <div id="transfer-{{ player.id }}" style="display: none; margin-top: 10px;">
                  <form method="post">
                    <input type="hidden" name="action" value="transfer_player">
                    <input type="hidden" name="player_id" value="{{ player.id }}">
                    <select name="new_team_id">
                      {% for t in teams %}{% if t.id != team.id %}
                        <option value="{{ t.id }}">{{ t.name }}</option>
                      {% endif %}{% endfor %}
                    </select>
                    <button type="submit">このチームに移籍</button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p style="padding-left: 15px; color: #888;">まだ選手が登録されていません。</p>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>まだチームが登録されていません。</p>
  {% endif %}

  <script>
    function toggleForm(formId) {
      const form = document.getElementById(formId);
      if (form.style.display === 'none') {
        form.style.display = 'block';
      } else {
        form.style.display = 'none';
      }
    }
  </script>
{% endblock %}