steps:
# 1. コンテナイメージをビルドするステップ
# Dockerfile を使用してイメージを作成します。
# '.' は Dockerfile があるディレクトリ（ルート）を指します。
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-t', 'gcr.io/$PROJECT_ID/nba2k-app:$COMMIT_SHA', '.' ]

# 2. 作成したイメージをコンテナレジストリにプッシュするステップ
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'push', 'gcr.io/$PROJECT_ID/nba2k-app:$COMMIT_SHA' ]

# 3. Cloud Run にデプロイするステップ
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: [
    'run', 'deploy', 'nba2k26-jpl',
    '--image', 'gcr.io/$PROJECT_ID/nba2k-app:$COMMIT_SHA',
    '--region', 'asia-northeast1', # あなたのリージョンに変更してください
    '--allow-unauthenticated' # 認証なしのアクセスを許可
  ]

# 4. ロギング設定の修正（エラーの解決）
# ここで CLOUD_LOGGING_ONLY を明示的に指定します。
options:
  logging: CLOUD_LOGGING_ONLY